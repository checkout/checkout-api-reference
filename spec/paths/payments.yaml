post:
  tags:
    - Payments
  summary: Request a payment
  description: |
    Checkout.com supports payments from a variety of sources, from cards to
    SEPA direct debits. The source of payment can be specified using the `source.type` field along with any source specific data.

    To verify the success of the payment, check the `approved` field in the response.

    ### Reference tokens

    The most common way of making card payments is using a token generated by [Frames](https://docs.checkout.com/v2/docs/frames).
    This is mandatory for non-PCI compliant merchants as it ensures no card details are transferred to your server.
    This integration method also applies to digital wallets such as Apple Pay and Google Pay.

    Note: Reference tokens expire after 15 minutes.

    ```json
    {
      "source": {
        "type": "token",
        "token": "tok_ubfj2q76miwundwlk72vxt2i7q",
        "billing_address": { ... },
        "phone": { ... }
      },
      "amount": 5600,
      "currency": "GBP"
    }
    ```

    #### Full card details

    To make a card payment specify the source type card.

    Note that full card payments should only be requested by PCI compliant merchants.

    ```json
    {
      "source": {
        "type": "card",
        "number": "4242424242424242",
        "expiry_month": 6,
        "expiry_year": 2018
      },
      "amount": 5600,
      "currency": "GBP"
    }
    ```

    ### Existing source

    When a card payment is processed you will be returned a source identifier that can later be used to make payments.
    You can also add payment sources for Alternative Payments via the [Sources API](#tag/Sources).

    ```json
    {
      "source": {
        "type": "id",
        "id": "src_wmlfc3zyhqzehihu7giusaaawu",
        "cvv" "843"
      },
      "amount": 5600,
      "currency": "GBP",
      "customer": {
        "id": "cus_yhn5qqcar3velcwqq47dmxjy4m"
      }
    }
    ```

    ### Customer

    You can provide the ID or email of an existing customer to make a payment using their default payment method.

    ```json
    {
      "source": {
        "type": "customer",
        "id": "cus_y3oqhf46pyzuxjbcn2giaqnb44",
      },
      "amount": 5600,
      "currency": "GBP"
    }
    ```

    ### Alternative payments

    Checkout.com supports a number of alternative payment methods. Reusable payment sources such as SEPA Direct Debits must first be created via the [Sources API](#tag/Sources).

    For non-reusable payment methods such as those that use a redirect flow (e.g. iDEAL), provide the name of the payment method as the `source.type` along with any payment method specific data.

    For the redirect flow, a 202 response will be returned containing the redirect href in the links.

    ```json
    {
      "source": {
        "type": "ideal",
        "issuer_id": "TESTISSUER01"
      },
      "amount": 5600,
      "currency": "GBP"
    }
    ```

  parameters:
    - in: header
      name: Cko-Idempotency-Key
      schema:
        type: string
      required: false
      description: Optional idempotency key for safely retrying payment requests

  requestBody:
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/PaymentRequest'
  responses:
    '201':
      description: Payment processed successfully
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PaymentResponse'
      headers:
        Cko-Request-Id:
          schema:
            $ref: "#/components/headers/Cko-Request-Id"
        Cko-Version:
          schema:
            $ref: "#/components/headers/Cko-Version"
    '202':
      description: Payment asynchronous or further action required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PaymentAcceptedResponse'
      headers:
        Cko-Request-Id:
          schema:
            $ref: "#/components/headers/Cko-Request-Id"
        Cko-Version:
          schema:
            $ref: "#/components/headers/Cko-Version"
    '401':
      description: Unauthorized
    '429':
      description: Too many requests or duplicate request detected
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'
    '422':
      description: Invalid data was sent
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'
    '502':
      description: Bad gateway
